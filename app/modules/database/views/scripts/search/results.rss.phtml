<?php
$feedArray = array(
    'title' => 'RSS feed of search results for: ' . $this->searchParams()->setParams(Zend_Controller_Front::getInstance()->getRequest()->getParams())->setFormat(false),
    'link' => $this->curUrl(),
    'charset' => 'utf-8',
    'description' => 'Latest finds on the Scheme database as rss',
    'author' => 'The Portable Antiquities Scheme',
    'image' => $this->serverUrl() . '/assets/logos/pas.jpg',
    'email' => 'info@finds.org.uk',
    'copyright' => 'Creative Commons Licenced',
    'generator' => 'The Scheme database powered by Zend Framework and Dan\'s magic',
    'language' => 'en',
    'entries' => array()
);
foreach ($this->results as $find) {

    if(array_key_exists('description', $find)){
        $description = str_replace(array("\n", "\r"), array('', ''), $find['description']);
    } else {
        $description = 'No description available';
    }

    if(array_key_exists('updated', $find)){
        $updated = strtotime($find['updated']);
    } else {
        $updated = strtotime($find['created']);
    }

    $feedArray['entries'][] = array(
        'title' => $find['old_findID'] . ' ' . $find['objecttype'] . ' ' . $find['broadperiod'],
        'link' => $this->serverUrl() . '/database/artefacts/record/id/' . $find['id'],
        'guid' => $this->serverUrl() . '/database/artefacts/record/id/' . $find['id'],
        'description' => $description,
        'lastUpdate' => $updated,
        'content' => $description,
    );
}
$feed = Zend_Feed::importArray($feedArray, 'rss');
$feed->send();